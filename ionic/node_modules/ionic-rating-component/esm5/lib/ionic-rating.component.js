import { __decorate } from "tslib";
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { IonicRatingService } from './ionic-rating.service';
var IonicRatingComponent = /** @class */ (function () {
    function IonicRatingComponent(ionicRatingService) {
        this.ionicRatingService = ionicRatingService;
        this.iconsArray = [];
        this.ratingChanged = new EventEmitter();
        this.readonly = 'false';
        this.activeColor = '#488aff';
        this.defaultColor = '#aaaaaa';
        this.activeIcon = 'star';
        this.defaultIcon = 'star-outline';
        this.halfIcon = 'star-half';
        this.halfStar = 'false';
        this.maxRating = 5;
        this.fontSize = '28px';
        this.eventInfo = (function () {
            var id = new Date().getTime();
            var topic = "star-rating:" + id + ":changed";
            return {
                topic: topic,
            };
        })();
        this.Math = Math;
        this.parseFloat = parseFloat;
    }
    IonicRatingComponent_1 = IonicRatingComponent;
    Object.defineProperty(IonicRatingComponent.prototype, "rating", {
        get: function () {
            return this._rating;
        },
        set: function (val) {
            this._rating = val;
            if (this.onChange) {
                this.onChange(val);
            }
        },
        enumerable: true,
        configurable: true
    });
    IonicRatingComponent.prototype.ngOnInit = function () {
        this.rating = this.rating || 3; //default after input`s initialization
        for (var i = 0; i < this.maxRating; i++) {
            this.iconsArray.push(i);
        }
    };
    IonicRatingComponent.prototype.writeValue = function (obj) {
        this.rating = obj;
    };
    IonicRatingComponent.prototype.registerOnChange = function (fn) {
        this.onChange = fn;
    };
    IonicRatingComponent.prototype.registerOnTouched = function (fn) {
        this.onTouched = fn;
    };
    IonicRatingComponent.prototype.setDisabledState = function (isDisabled) {
        this.readonly = isDisabled ? "true" : "false";
    };
    IonicRatingComponent.prototype.changeRating = function (event) {
        if (this.readonly && this.readonly === 'true')
            return;
        // event is different for firefox and chrome
        var id = event.target.id ? parseInt(event.target.id) : parseInt(event.target.parentElement.id);
        if (this.halfStar && this.halfStar === 'true') {
            this.rating = ((this.rating - id > 0) && (this.rating - id <= 0.5)) ? id + 1 : id + .5;
        }
        else {
            this.rating = id + 1;
        }
        // subscribe this event to get the changed value in your parent compoanent
        this.ionicRatingService.publishStartRatingChanged(this.rating);
        this.ionicRatingService.publishTopic(this.eventInfo.topic, this.rating);
        // unique event
        this.ratingChanged.emit(this.rating);
    };
    var IonicRatingComponent_1;
    IonicRatingComponent.ctorParameters = function () { return [
        { type: IonicRatingService }
    ]; };
    __decorate([
        Output()
    ], IonicRatingComponent.prototype, "ratingChanged", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "readonly", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "activeColor", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "defaultColor", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "activeIcon", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "defaultIcon", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "halfIcon", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "halfStar", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "maxRating", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "fontSize", void 0);
    __decorate([
        Input()
    ], IonicRatingComponent.prototype, "rating", null);
    IonicRatingComponent = IonicRatingComponent_1 = __decorate([
        Component({
            selector: 'ionic-rating-component',
            template: "\n    <div class=\"ionic5-star-rating\">\n      <ion-button size=\"large\" fill=\"clear\" class=\"rate-button\" [ngStyle]=\"{'width' : fontSize, 'height' : fontSize}\" *ngFor=\"let index of iconsArray\" id=\"{{index}}\" (click)=\"changeRating($event)\">\n        <ion-icon  [ngStyle]=\"{'color':index < this.Math.round(this.parseFloat(rating)) ? activeColor : defaultColor, 'font-size' : fontSize }\" name=\"{{(halfStar ==='true' && (rating - index > 0) && (rating - index <= 0.5)) ? halfIcon : (index < this.Math.round(this.parseFloat(rating))) ? activeIcon : defaultIcon}}\"></ion-icon>\n      </ion-button>\n    </div>\n  ",
            providers: [
                {
                    provide: NG_VALUE_ACCESSOR,
                    useExisting: IonicRatingComponent_1,
                    multi: true,
                },
            ],
            styles: ["\n    .rate-button {\n            --padding-bottom:0;\n            --padding-end:0;\n            --padding-start:0;\n            --padding-top:0;\n    }\n  "]
        })
    ], IonicRatingComponent);
    return IonicRatingComponent;
}());
export { IonicRatingComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW9uaWMtcmF0aW5nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2lvbmljLXJhdGluZy1jb21wb25lbnQvIiwic291cmNlcyI6WyJsaWIvaW9uaWMtcmF0aW5nLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMvRSxPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUEwQjVEO0lBeUVFLDhCQUFvQixrQkFBc0M7UUFBdEMsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQWxFMUQsZUFBVSxHQUFhLEVBQUUsQ0FBQztRQUUxQixrQkFBYSxHQUF5QixJQUFJLFlBQVksRUFBVSxDQUFDO1FBRWpFLGFBQVEsR0FBVyxPQUFPLENBQUM7UUFFM0IsZ0JBQVcsR0FBVyxTQUFTLENBQUM7UUFFaEMsaUJBQVksR0FBVyxTQUFTLENBQUM7UUFFakMsZUFBVSxHQUFXLE1BQU0sQ0FBQztRQUU1QixnQkFBVyxHQUFXLGNBQWMsQ0FBQztRQUVyQyxhQUFRLEdBQVcsV0FBVyxDQUFDO1FBRS9CLGFBQVEsR0FBVyxPQUFPLENBQUM7UUFFM0IsY0FBUyxHQUFXLENBQUMsQ0FBQztRQUV0QixhQUFRLEdBQVcsTUFBTSxDQUFDO1FBZ0JWLGNBQVMsR0FBRyxDQUFDO1lBQzNCLElBQU0sRUFBRSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDaEMsSUFBTSxLQUFLLEdBQUcsaUJBQWUsRUFBRSxhQUFVLENBQUM7WUFDMUMsT0FBTztnQkFDTCxLQUFLLE9BQUE7YUFDTixDQUFDO1FBQ0osQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQXlCSCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztR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QUVoQztRQURDLEtBQUssRUFBRTs4REFDeUI7SUFFakM7UUFEQyxLQUFLLEVBQUU7NERBQ29CO0lBRTVCO1FBREMsS0FBSyxFQUFFOzZEQUM2QjtJQUVyQztRQURDLEtBQUssRUFBRTswREFDdUI7SUFFL0I7UUFEQyxLQUFLLEVBQUU7MERBQ21CO0lBRTNCO1FBREMsS0FBSyxFQUFFOzJEQUNjO0lBRXRCO1FBREMsS0FBSyxFQUFFOzBEQUNrQjtJQUUxQjtRQURDLEtBQUssRUFBRTtzREFNUDtJQWxDVSxvQkFBb0I7UUF4QmhDLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSx3QkFBd0I7WUFDbEMsUUFBUSxFQUFFLG1uQkFNVDtZQVFELFNBQVMsRUFBRTtnQkFDVDtvQkFDRSxPQUFPLEVBQUUsaUJBQWlCO29CQUMxQixXQUFXLEVBQUUsc0JBQW9CO29CQUNqQyxLQUFLLEVBQUUsSUFBSTtpQkFDWjthQUNGO3FCQWRXLDhKQU9YO1NBUUYsQ0FBQztPQUNXLG9CQUFvQixDQTZGaEM7SUFBRCwyQkFBQztDQUFBLEFBN0ZELElBNkZDO1NBN0ZZLG9CQUFvQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IElvbmljUmF0aW5nU2VydmljZSB9IGZyb20gJy4vaW9uaWMtcmF0aW5nLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdpb25pYy1yYXRpbmctY29tcG9uZW50JyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2IGNsYXNzPVwiaW9uaWM1LXN0YXItcmF0aW5nXCI+XG4gICAgICA8aW9uLWJ1dHRvbiBzaXplPVwibGFyZ2VcIiBmaWxsPVwiY2xlYXJcIiBjbGFzcz1cInJhdGUtYnV0dG9uXCIgW25nU3R5bGVdPVwieyd3aWR0aCcgOiBmb250U2l6ZSwgJ2hlaWdodCcgOiBmb250U2l6ZX1cIiAqbmdGb3I9XCJsZXQgaW5kZXggb2YgaWNvbnNBcnJheVwiIGlkPVwie3tpbmRleH19XCIgKGNsaWNrKT1cImNoYW5nZVJhdGluZygkZXZlbnQpXCI+XG4gICAgICAgIDxpb24taWNvbiAgW25nU3R5bGVdPVwieydjb2xvcic6aW5kZXggPCB0aGlzLk1hdGgucm91bmQodGhpcy5wYXJzZUZsb2F0KHJhdGluZykpID8gYWN0aXZlQ29sb3IgOiBkZWZhdWx0Q29sb3IsICdmb250LXNpemUnIDogZm9udFNpemUgfVwiIG5hbWU9XCJ7eyhoYWxmU3RhciA9PT0ndHJ1ZScgJiYgKHJhdGluZyAtIGluZGV4ID4gMCkgJiYgKHJhdGluZyAtIGluZGV4IDw9IDAuNSkpID8gaGFsZkljb24gOiAoaW5kZXggPCB0aGlzLk1hdGgucm91bmQodGhpcy5wYXJzZUZsb2F0KHJhdGluZykpKSA/IGFjdGl2ZUljb24gOiBkZWZhdWx0SWNvbn19XCI+PC9pb24taWNvbj5cbiAgICAgIDwvaW9uLWJ1dHRvbj5cbiAgICA8L2Rpdj5cbiAgYCwgc3R5bGVzOiBbYFxuICAgIC5yYXRlLWJ1dHRvbiB7XG4gICAgICAgICAgICAtLXBhZGRpbmctYm90dG9tOjA7XG4gICAgICAgICAgICAtLXBhZGRpbmctZW5kOjA7XG4gICAgICAgICAgICAtLXBhZGRpbmctc3RhcnQ6MDtcbiAgICAgICAgICAgIC0tcGFkZGluZy10b3A6MDtcbiAgICB9XG4gIGBdLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBJb25pY1JhdGluZ0NvbXBvbmVudCxcbiAgICAgIG11bHRpOiB0cnVlLFxuICAgIH0sXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIElvbmljUmF0aW5nQ29tcG9uZW50IGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE9uSW5pdCB7XG4gIHByaXZhdGUgX3JhdGluZzogbnVtYmVyO1xuICBwcml2YXRlIG9uQ2hhbmdlOiBhbnk7XG4gIHByaXZhdGUgb25Ub3VjaGVkOiBhbnk7XG4gIHB1YmxpYyBkaXNhYmxlZDogYm9vbGVhbjtcbiAgTWF0aDogYW55O1xuICBwYXJzZUZsb2F0OiBhbnk7XG4gIGljb25zQXJyYXk6IG51bWJlcltdID0gW107XG4gIEBPdXRwdXQoKVxuICByYXRpbmdDaGFuZ2VkOiBFdmVudEVtaXR0ZXI8bnVtYmVyPiA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xuICBASW5wdXQoKVxuICByZWFkb25seTogc3RyaW5nID0gJ2ZhbHNlJztcbiAgQElucHV0KClcbiAgYWN0aXZlQ29sb3I6IHN0cmluZyA9ICcjNDg4YWZmJztcbiAgQElucHV0KClcbiAgZGVmYXVsdENvbG9yOiBzdHJpbmcgPSAnI2FhYWFhYSc7XG4gIEBJbnB1dCgpXG4gIGFjdGl2ZUljb246IHN0cmluZyA9ICdzdGFyJztcbiAgQElucHV0KClcbiAgZGVmYXVsdEljb246IHN0cmluZyA9ICdzdGFyLW91dGxpbmUnO1xuICBASW5wdXQoKVxuICBoYWxmSWNvbjogc3RyaW5nID0gJ3N0YXItaGFsZic7XG4gIEBJbnB1dCgpXG4gIGhhbGZTdGFyOiBzdHJpbmcgPSAnZmFsc2UnO1xuICBASW5wdXQoKVxuICBtYXhSYXRpbmc6IG51bWJlciA9IDU7XG4gIEBJbnB1dCgpXG4gIGZvbnRTaXplOiBzdHJpbmcgPSAnMjhweCc7XG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBzZXQgcmF0aW5nKHZhbDogbnVtYmVyKSB7XG4gICAgdGhpcy5fcmF0aW5nID0gdmFsO1xuICAgIGlmICh0aGlzLm9uQ2hhbmdlKSB7XG4gICAgICB0aGlzLm9uQ2hhbmdlKHZhbCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5yYXRpbmcgPSB0aGlzLnJhdGluZyB8fCAzOyAvL2RlZmF1bHQgYWZ0ZXIgaW5wdXRgcyBpbml0aWFsaXphdGlvblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tYXhSYXRpbmc7IGkrKykge1xuICAgICAgdGhpcy5pY29uc0FycmF5LnB1c2goaSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHJlYWRvbmx5IGV2ZW50SW5mbyA9ICgoKSA9PiB7XG4gICAgY29uc3QgaWQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICBjb25zdCB0b3BpYyA9IGBzdGFyLXJhdGluZzoke2lkfTpjaGFuZ2VkYDtcbiAgICByZXR1cm4ge1xuICAgICAgdG9waWMsXG4gICAgfTtcbiAgfSkoKTtcblxuICB3cml0ZVZhbHVlKG9iajogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5yYXRpbmcgPSBvYmo7XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLm9uQ2hhbmdlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWQgPSBmbjtcbiAgfVxuXG4gIHNldERpc2FibGVkU3RhdGU/KGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLnJlYWRvbmx5ID0gaXNEaXNhYmxlZCA/IFwidHJ1ZVwiIDogXCJmYWxzZVwiO1xuICB9XG5cblxuICBwdWJsaWMgZ2V0IHJhdGluZygpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9yYXRpbmc7XG4gIH1cblxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaW9uaWNSYXRpbmdTZXJ2aWNlOiBJb25pY1JhdGluZ1NlcnZpY2UpIHtcbiAgICB0aGlzLk1hdGggPSBNYXRoO1xuICAgIHRoaXMucGFyc2VGbG9hdCA9IHBhcnNlRmxvYXQ7XG4gIH1cblxuICBjaGFuZ2VSYXRpbmcoZXZlbnQpIHtcbiAgICBpZiAodGhpcy5yZWFkb25seSAmJiB0aGlzLnJlYWRvbmx5ID09PSAndHJ1ZScpIHJldHVybjtcbiAgICAvLyBldmVudCBpcyBkaWZmZXJlbnQgZm9yIGZpcmVmb3ggYW5kIGNocm9tZVxuICAgIGxldCBpZCA9IGV2ZW50LnRhcmdldC5pZCA/IHBhcnNlSW50KGV2ZW50LnRhcmdldC5pZCkgOiBwYXJzZUludChldmVudC50YXJnZXQucGFyZW50RWxlbWVudC5pZCk7XG4gICAgaWYgKHRoaXMuaGFsZlN0YXIgJiYgdGhpcy5oYWxmU3RhciA9PT0gJ3RydWUnKSB7XG4gICAgICB0aGlzLnJhdGluZyA9ICgodGhpcy5yYXRpbmcgLSBpZCA+IDApICYmICh0aGlzLnJhdGluZyAtIGlkIDw9IDAuNSkpID8gaWQgKyAxIDogaWQgKyAuNTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yYXRpbmcgPSBpZCArIDE7XG4gICAgfVxuICAgIC8vIHN1YnNjcmliZSB0aGlzIGV2ZW50IHRvIGdldCB0aGUgY2hhbmdlZCB2YWx1ZSBpbiB5b3VyIHBhcmVudCBjb21wb2FuZW50XG4gICAgdGhpcy5pb25pY1JhdGluZ1NlcnZpY2UucHVibGlzaFN0YXJ0UmF0aW5nQ2hhbmdlZCh0aGlzLnJhdGluZyk7XG4gICAgdGhpcy5pb25pY1JhdGluZ1NlcnZpY2UucHVibGlzaFRvcGljKHRoaXMuZXZlbnRJbmZvLnRvcGljLCB0aGlzLnJhdGluZyk7XG4gICAgLy8gdW5pcXVlIGV2ZW50XG4gICAgdGhpcy5yYXRpbmdDaGFuZ2VkLmVtaXQodGhpcy5yYXRpbmcpO1xuICB9XG59XG4iXX0=