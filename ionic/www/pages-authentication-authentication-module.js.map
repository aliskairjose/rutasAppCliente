{"version":3,"sources":["./src/app/pages/authentication/authentication.page.ts","./src/app/pages/authentication/authentication-routing.module.ts","./src/app/pages/authentication/authentication.module.ts","./node_modules/@codetrix-studio/capacitor-google-auth/dist/esm/index.js","./node_modules/@codetrix-studio/capacitor-google-auth/dist/esm/web.js","./src/app/pages/authentication/authentication.page.html"],"names":[],"mappings":"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","file":"pages-authentication-authentication-module.js","sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { Router } from '@angular/router';\r\nimport '@codetrix-studio/capacitor-google-auth';\r\nimport { Plugins } from '@capacitor/core';\r\nimport { AuthService } from '../../services/auth.service';\r\nimport { StorageService } from '../../services/storage.service';\r\nimport { ERROR_FORM, LOGO } from '../../constants/global-constants';\r\nimport { CommonService } from '../../services/common.service';\r\nimport { LoadingController } from '@ionic/angular';\r\n\r\n@Component( {\r\n  selector: 'app-authentication',\r\n  templateUrl: './authentication.page.html',\r\n  styleUrls: [ './authentication.page.scss' ],\r\n} )\r\nexport class AuthenticationPage implements OnInit {\r\n\r\n  loginForm: FormGroup;\r\n  submitted: boolean;\r\n  formError = ERROR_FORM;\r\n  logo = LOGO;\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private _auth: AuthService,\r\n    private _storage: StorageService,\r\n    private formBuilder: FormBuilder,\r\n    private _common: CommonService,\r\n  ) {\r\n    this.createForm();\r\n\r\n  }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n  get f() { return this.loginForm.controls; }\r\n\r\n  async googleLogin() {\r\n    const googleUser = await Plugins.GoogleAuth.signIn();\r\n    if ( googleUser.authentication.idToken ) {\r\n      const loading = await this._common.presentLoading();\r\n      loading.present();\r\n\r\n      this._auth.googleLogin( googleUser ).subscribe( async ( result ) => {\r\n        loading.dismiss();\r\n        await this._storage.store( 'rp_token', googleUser.authentication.idToken );\r\n        await this._storage.store( 'rp_user', googleUser );\r\n        this.router.navigate( [ '/sidemenu/Inicio' ] );\r\n      }, () => loading.dismiss() );\r\n    }\r\n  }\r\n\r\n  async onSubmit() {\r\n    this.submitted = true;\r\n    if ( this.loginForm.valid ) {\r\n      const loading = await this._common.presentLoading();\r\n      loading.present();\r\n      this._auth.login( this.loginForm.value ).subscribe( async ( response ) => {\r\n        loading.dismiss();\r\n        this._auth.AuthSubject( response.user );\r\n        const message = response.message;\r\n        const color = 'primary';\r\n        this._common.presentToast( { message, color } );\r\n        await this._storage.store( 'rp_token', response.data );\r\n        await this._storage.store( 'rp_user', response.user );\r\n        this.router.navigate( [ '/sidemenu/Inicio' ] );\r\n      }, () => loading.dismiss() );\r\n    }\r\n  }\r\n\r\n  private createForm(): void {\r\n    this.loginForm = this.formBuilder.group( {\r\n      email: [ '', [ Validators.required, Validators.email ] ],\r\n      password: [ '', [ Validators.required, Validators.minLength( 8 ) ] ],\r\n    } );\r\n  }\r\n\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\nimport { AuthenticationPage } from './authentication.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: AuthenticationPage\r\n  }\r\n];\r\n\r\n@NgModule( {\r\n  imports: [ RouterModule.forChild( routes ) ],\r\n  exports: [ RouterModule ],\r\n} )\r\nexport class AuthenticationPageRoutingModule { }\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { AuthenticationPageRoutingModule } from './authentication-routing.module';\r\n\r\nimport { AuthenticationPage } from './authentication.page';\r\n\r\n@NgModule( {\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    AuthenticationPageRoutingModule,\r\n    ReactiveFormsModule\r\n  ],\r\n  declarations: [ AuthenticationPage ]\r\n} )\r\nexport class AuthenticationPageModule { }\r\n","export * from './web';\n//# sourceMappingURL=index.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { WebPlugin } from '@capacitor/core';\n// @ts-ignore\nimport config from '../../../../../capacitor.config.json';\nexport class GoogleAuthWeb extends WebPlugin {\n    get webConfigured() {\n        return document.getElementsByName('google-signin-client_id').length > 0;\n    }\n    constructor() {\n        super({\n            name: 'GoogleAuth',\n            platforms: ['web']\n        });\n        if (!this.webConfigured)\n            return;\n        this.gapiLoaded = new Promise(resolve => {\n            // HACK: Relying on window object, can't get property in gapi.load callback\n            window.gapiResolve = resolve;\n            this.initialize();\n        });\n        this.addUserChangeListener();\n    }\n    initialize() {\n        var head = document.getElementsByTagName('head')[0];\n        var script = document.createElement('script');\n        script.type = 'text/javascript';\n        script.defer = true;\n        script.async = true;\n        script.onload = this.platformJsLoaded;\n        script.src = 'https://apis.google.com/js/platform.js';\n        head.appendChild(script);\n    }\n    platformJsLoaded() {\n        gapi.load('auth2', () => {\n            const clientConfig = {\n                client_id: document.getElementsByName('google-signin-client_id')[0].content\n            };\n            if (config.plugins.GoogleAuth != null && config.plugins.GoogleAuth.scopes != null) {\n                clientConfig.scope = config.plugins.GoogleAuth.scopes.join(' ');\n            }\n            gapi.auth2.init(clientConfig);\n            window.gapiResolve();\n        });\n    }\n    signIn() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return new Promise((resolve, reject) => __awaiter(this, void 0, void 0, function* () {\n                try {\n                    var serverAuthCode;\n                    var needsOfflineAccess = false;\n                    try {\n                        needsOfflineAccess = config.plugins.GoogleAuth.serverClientId != null;\n                    }\n                    catch (_a) {\n                    }\n                    if (needsOfflineAccess) {\n                        const offlineAccessResponse = yield gapi.auth2.getAuthInstance().grantOfflineAccess();\n                        serverAuthCode = offlineAccessResponse.code;\n                    }\n                    else {\n                        yield gapi.auth2.getAuthInstance().signIn();\n                    }\n                    const googleUser = gapi.auth2.getAuthInstance().currentUser.get();\n                    if (needsOfflineAccess) {\n                        // HACK: AuthResponse is null if we don't do this when using grantOfflineAccess\n                        yield googleUser.reloadAuthResponse();\n                    }\n                    const user = this.getUserFrom(googleUser);\n                    user.serverAuthCode = serverAuthCode;\n                    resolve(user);\n                }\n                catch (error) {\n                    reject(error);\n                }\n            }));\n        });\n    }\n    refresh() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const authResponse = yield gapi.auth2.getAuthInstance().currentUser.get().reloadAuthResponse();\n            return {\n                accessToken: authResponse.access_token,\n                idToken: authResponse.id_token\n            };\n        });\n    }\n    signOut() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return gapi.auth2.getAuthInstance().signOut();\n        });\n    }\n    addUserChangeListener() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.gapiLoaded;\n            gapi.auth2.getAuthInstance().currentUser.listen(googleUser => {\n                this.notifyListeners(\"userChange\", googleUser.isSignedIn() ? this.getUserFrom(googleUser) : null);\n            });\n        });\n    }\n    getUserFrom(googleUser) {\n        const user = {};\n        const profile = googleUser.getBasicProfile();\n        user.email = profile.getEmail();\n        user.familyName = profile.getFamilyName();\n        user.givenName = profile.getGivenName();\n        user.id = profile.getId();\n        user.imageUrl = profile.getImageUrl();\n        user.name = profile.getName();\n        const authResponse = googleUser.getAuthResponse(true);\n        user.authentication = {\n            accessToken: authResponse.access_token,\n            idToken: authResponse.id_token\n        };\n        return user;\n    }\n}\nconst GoogleAuth = new GoogleAuthWeb();\nexport { GoogleAuth };\nimport { registerWebPlugin } from '@capacitor/core';\nregisterWebPlugin(GoogleAuth);\n//# sourceMappingURL=web.js.map","export default \"<ion-content>\\r\\n  <div class=\\\"signupPageWrapper\\\">\\r\\n    <div class=\\\"signupLogoWrapper\\\">\\r\\n      <img [src]=\\\"logo\\\" alt=\\\"broken\\\" height=\\\"50vh\\\" />\\r\\n    </div>\\r\\n    <div class=\\\"signupFormWrapper\\\">\\r\\n      <ion-text class=\\\"signupTitleText\\\">Inicie sesion</ion-text>\\r\\n      <form [formGroup]=\\\"loginForm\\\" (ngSubmit)=\\\"onSubmit()\\\" novalidate class=\\\"signupForm\\\">\\r\\n        <ion-item>\\r\\n          <ion-input type=\\\"email\\\" class=\\\"form-controll\\\" formControlName=\\\"email\\\" placeholder=\\\"Usuario\\\"></ion-input>\\r\\n        </ion-item>\\r\\n        <div *ngIf=\\\"submitted && f.email.errors\\\">\\r\\n          <div *ngIf=\\\"f.email.errors.required\\\">\\r\\n            <ion-label text-wrap color=\\\"danger\\\">\\r\\n              {{formError.required}}\\r\\n            </ion-label>\\r\\n          </div>\\r\\n          <div *ngIf=\\\"f.email.errors.email\\\">\\r\\n            <ion-label text-wrap color=\\\"danger\\\">\\r\\n              {{formError.invalidEmail}}\\r\\n            </ion-label>\\r\\n          </div>\\r\\n        </div>\\r\\n        <ion-item>\\r\\n          <ion-input type=\\\"password\\\" class=\\\"form-controll\\\" formControlName=\\\"password\\\" placeholder=\\\"Contrasena\\\">\\r\\n          </ion-input>\\r\\n        </ion-item>\\r\\n        <div *ngIf=\\\"submitted && f.password.errors\\\">\\r\\n          <div *ngIf=\\\"f.password.errors.required\\\">\\r\\n            <ion-label text-wrap color=\\\"danger\\\">\\r\\n              {{formError.required}}\\r\\n            </ion-label>\\r\\n          </div>\\r\\n          <div *ngIf=\\\"f.password.errors.minlength\\\">\\r\\n            <ion-label text-wrap color=\\\"danger\\\">\\r\\n              {{formError.minLength}} 6\\r\\n            </ion-label>\\r\\n          </div>\\r\\n        </div>\\r\\n        <div class=\\\"forgotLinkWrapper\\\">\\r\\n          <ion-text [routerLink]=\\\"['/forgot-password']\\\" class=\\\"signupSmallText ion-float-right\\\">Olvido su contraseña?\\r\\n          </ion-text>\\r\\n        </div>\\r\\n        <div class=\\\"ion-text-center ion-margin-vertical\\\">\\r\\n          <ion-button color=\\\"warning\\\" class=\\\"signupMedText\\\" type=\\\"submit\\\">\\r\\n            Iniciar sesion</ion-button>\\r\\n        </div>\\r\\n        <div class=\\\"ion-text-center\\\">\\r\\n          <ion-text [routerLink]=\\\"['/register']\\\" class=\\\"signupSmallTex\\\">Registrese</ion-text>\\r\\n        </div>\\r\\n      </form>\\r\\n    </div>\\r\\n    <div class=\\\"btnWrapper\\\">\\r\\n      <ion-text class=\\\"signupSmallText signupGrayText\\\">Inicie sesion con</ion-text>\\r\\n      <ion-button color=\\\"light\\\" (click)=\\\"googleLogin()\\\">\\r\\n        <img src=\\\"./../../../assets/icon/googleLogo.png\\\" alt=\\\"broken\\\" width=\\\"30\\\" height=\\\"30\\\" class=\\\"googleLogoMargin\\\" />\\r\\n        <ion-text class=\\\"signupMedText signupGrayText googleText\\\">Google</ion-text>\\r\\n      </ion-button>\\r\\n    </div>\\r\\n  </div>\\r\\n</ion-content>\";"],"sourceRoot":"webpack:///"}